<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
   <meta charset="UTF-8">
   <title>Insert title here</title>
   <!-- jQuery 라이브러리 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
   function fileDelete(){
      frm.action = "/solo/fileDelete"
      frm.submit()
   }
   
</script>
</head>

<body>
   <header>
      <div th:insert="~{header :: header}"></div>
   </header>
   <h1>solo/ModifyForm</h1>
   [[${dto}]]
   <form name="frm" method="post" enctype="multipart/form-data" th:object="${dto}">
      <input type="hidden" th:field="*{sid}" />
      <table border="">

         <tr>
            <td>이름</td>
            <td><input type="text" th:field="*{sname}" /></td>
         </tr>
         <tr id="zpassword">
            <td>기존비밀번호</td>
            <td>
               <input type="password" th:value="*{spw}" id="spw" readonly />
               <input type="button" value="비밀번호 변경" id="changePasswordButton" />
            </td>
         </tr>
         <tr id="passwordChangeRow" style="display: none;">
            <td>새 비밀번호</td>
            <td><input type="password" th:field="*{spw}" id="newSpw" /></td>
         </tr>
         <tr id="passwordConfirmationRow" style="display: none;">
            <td>비밀번호 확인</td>
            <td><input type="password" name="spw2" id="spw2" /></td>
         </tr>
         <tr>
            <td>주민등록 수정</td>
            <td>
               <input type="text" id="jumin" name="sjumin" placeholder="주민번호 앞 6자리입력" />
               <input type="button" onclick="Birth()" value="생년월일 및 나이 수정" />
            </td>
         </tr>
         <tr>
            <td>생년월일</td>
            <td><input type="text" th:field="*{sbirth}" id="birth" name="sbirth" required readonly /></td>
         </tr>
         <tr>
            <td>나이</td>
            <td><input type="number" th:field="*{sage}" id="age" name="sage" required readonly /></td>
         </tr>
         <tr>
            <td>성별</td>
            <td>
               <label><input type="radio" name="sgender" value="남성" th:checked="${dto.sgender == '남성'}"> 남성</label>
               <label><input type="radio" name="sgender" value="여성" th:checked="${dto.sgender == '여성'}"> 여성</label>
            </td>
         </tr>
         <tr>
            <td>전화번호</td>
            <td><input type="text" th:field="*{sphone}" /></td>
         </tr>
         <tr>
            <td>이메일</td>
            <td><input type="text" th:field="*{semail}" /></td>
            </td>

         </tr>
         <tr>
            <td>주소</td>
            <td><input type="text" th:field="*{saddress}" />
            </td>
         </tr>


         
         <!-- 회사 이름 필드 -->
         <tr id="companyNameMenu">
            <td>회사 이름</td>
            <td>
               <input type="text" name="scompanyName" list="company-list" class="company-list" />
               <input type="hidden" name="cid" id="cid" />

               <datalist id="company-list">
                  <th:block th:each="recruit : ${mainData}">
                       <option th:text="${recruit.cname}" class="company-list" th:data-company-number="${recruit.cid}" />
                      <span th:text="|회사번호 ${recruit.ccall}|" class="company-list"></span>
                      
                  </th:block>
               </datalist>
            </td>
         </tr>

         <!-- 회사 재직증명서 파일 업로드 필드 -->
         <tr id="companyFileMenu">
            <td>회사 재직증명서</td>
            <td>
               <th:block th:if="${dto.scompanyFile != null}">
               <input type="hidden" th:field="*{scompanyFile}" readonly/>
               <input type="button" onclick="fileDelete()" th:value="|*{scompanyFile} 파일삭제|" />

               </th:block>
               <input th:unless="${dto.scompanyFile != null}" type="file" th:field="*{mmff}" />



            </td>
         </tr>

         <tr>

            <td colspan="2" align="center">
               <input type="submit" value="수정" />
            </td>
            <td colspan="2" align="center">
               <input type="reset" value="리셋" />
            </td>
            <td colspan="2" align="center">
               <a href="/solo/solo_info">뒤로</a>
            </td>
         </tr>


      </table>
   </form>
   <script>
   
   
   
  document.addEventListener('DOMContentLoaded', function() {
            const scompanyNameInput = document.querySelector('input[name="scompanyName"]');
            const cidInput = document.getElementById('cid');
            const dataListOptions = document.querySelectorAll('#company-list option');
            const companyNumberElement = document.getElementById('company-number');

            // 입력 필드에 입력이 발생할 때마다 실행되는 함수
            scompanyNameInput.addEventListener('input', function() {
                const inputValue = scompanyNameInput.value;
                
                // 모든 option 요소를 순회하면서 일치하는 값을 찾습니다.
                for (const option of dataListOptions) {
                    if (option.value === inputValue) {
                        // 일치하는 값이 있으면 해당 회사번호를 숨겨진 input에 설정합니다.
                        cidInput.value = option.getAttribute('data-company-number');
                        // 회사번호를 출력합니다.
                        companyNumberElement.textContent = `회사번호: ${cidInput.value}`;
                        return; // 값을 찾았으므로 반복문 종료
                    }
                }
         
                // 일치하는 값이 없을 경우 숨겨진 input과 출력을 비웁니다.
                cidInput.value = '';
                companyNumberElement.textContent = '';
            });
        });
   
      $(document).ready(function () {
         // 페이지 로드 시, 기존 비밀번호 필드의 값을 새 비밀번호 필드에 설정
         var oldPassword = $("#spw").val();
         $("#newSpw").val(oldPassword);
      });

      // 비밀번호 변경 버튼 클릭 시
      $("#changePasswordButton").click(function () {
         $("#zpassword").hide(); // 기존 비밀번호 필드 숨김
         $("#newSpw").val(""); // 새 비밀번호 필드 리셋
         $("#passwordConfirmationRow").show(); // 비밀번호 확인 필드 표시
         $("#passwordChangeRow").show(); // 비밀번호 확인 필드 표시
      });
         function Birth() {
         const jumin = document.getElementById("jumin").value;
         const birthField = document.getElementById("birth");
         const ageField = document.getElementById("age");

         if (jumin.length !== 6) {
            alert("주민등록번호 앞자리는 6자리여야 합니다.");
            return;
         }


         const year = parseInt(jumin.substr(0, 2));
         const month = parseInt(jumin.substr(2, 2));
         const day = parseInt(jumin.substr(4, 2));

         let birthYear = year;
         if (year < 24) {
            birthYear += 2000;
         } else {
            birthYear += 1900;
         }

         const birthDate = `${birthYear}-${month}-${day}`;
         const today = new Date();
         ageField.value = today.getFullYear() - birthYear + 1;
         birthField.value = birthDate;
      }
   </script>
</body>

</html>