<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>마이페이지 수정</title>
	<!-- jQuery 라이브러리 추가 -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:inlin="javascript">
		function fileloDelete() {
			alert("파일삭제가즈")

			frm.action = "/company/fileloDelete"
			frm.submit()
		}

	</script>
</head>


<body>
   <header>
      <div th:insert="~{header :: header}"></div>
   </header>
	<h1>마이페이지 수정</h1>
	<h3>기업아이디, 대표자, 개업일, 기업주소, 사업자등록증은 변경이 불가능합니다.</h3>
	<h4>사업자등록증을 갱신하거나 주소이전을 하시면 1:1문의로 문의 바랍니다.</h4>
	
	<form name="frm" method="post" enctype="multipart/form-data" th:object="${dto}">
		<input type="hidden" th:field="*{cid}" />
		<table border="">
			<tr>
				<td>기업로고</td>
				<td>
					<th:block th:if="${dto.clogo != null}">
						<input type="hidden" th:field="*{clogo}" />
						<input type="button" onclick="fileloDelete()" th:value="|*{clogo} 로고삭제|" />

					</th:block>
					<input th:unless="${dto.clogo!= null}" type="file" th:field="*{lommff}" id="lommff" required onchange="validateFile()"/>
					<div id="fileError" style="color: red;"></div>


				</td>
			</tr>
			<tr>
				<td>기업이름</td>
				<td><input type="text" th:field="*{cname}" /></td>
			</tr>
			<tr>
				<td>대표자</td>
				<td><input type="text" th:field="*{cceo}" readonly/>관리자에게 요청</td>
			</tr>
			<tr>
				<td>개업연월일</td>
				<td><input type="date" th:field="*{cbuild}" readonly/>관리자에게 요청</td>
			</tr>
			<tr id="zpassword">
				<td>기존비밀번호</td>
				<td>
					<input type="password" th:value="*{cpw}" id="cpw" />
					<input type="button" value="비밀번호 변경" id="changePasswordButton" />
				</td>
			</tr>
			<tr id="passwordChangeRow" style="display: none;">
				<td>새 비밀번호</td>
				<td><input type="password" th:field="*{cpw}" id="newCpw" /></td>
			</tr>
			<tr id="passwordConfirmationRow" style="display: none;">
				<td>비밀번호 확인</td>
				<td><input type="password" name="cpw2" id="cpw2" /></td>
			</tr>
			<tr>
				<td>업종</td>
				<td><input type="text" th:field="*{ccategory}" /></td>
			</tr>
			
			<tr>
				<td>직원수</td>
				<td><input type="text" th:field="*{cstaff}" /></td>
			</tr>
			<tr>
				<td>한해매출액(단위:100만원)</td>
				<td><input type="text" th:field="*{csales}" /></td>
			</tr>
			<tr>
				<td>이메일</td>
				<td><input type="email" th:field="*{cemail}" /></td>
			</tr>
			<tr>
				<td>전화번호</td>
				<td><input type="text" th:field="*{ccall}" /></td>
			</tr>
			<tr>
				<td>본점소재지</td>
				<td><input type="text" th:field="*{caddress}" readonly />관리자에게 요청</td>
			</tr>
				<tr>
				<td>내용</td>
				<td><textarea th:field="*{ccontent}" /></td>
			</tr>
			</tr>
				<tr>
				<td>복지 및 해택</td>
				<td><textarea th:field="*{cwelfare}" /></td>
			</tr>
			

			<tr>
				<td>사업자등록증</td>
				<td>
					<th:block th:if="${dto.ccompanyFile != null}">
					<input type="text" th:field="*{ccompanyFile}" readonly>관리자에게 요청</input>
					
					
					</th:block>
					<th:block th:unless="${dto.ccompanyFile != null}">
					<span th:text="'사업자등록증이 존재하지 않습니다.'"></span>	
					</th:block>
					
					

				</td>
			</tr>
			<tr>
				<td colspan="2" align="center">
					<input type="submit" value="수정" />
					<a href="/company/mypage" />
				</td>
			</tr>
		</table>
	</form>

	<!-- JavaScript 코드 추가 -->
	<!-- JavaScript 코드 추가 -->
	<script>
		$(document).ready(function () {
			// 페이지 로드 시, 기존 비밀번호 필드의 값을 새 비밀번호 필드에 설정
			var oldPassword = $("#cpw").val();
			$("#newCpw").val(oldPassword);
		});

		// 비밀번호 변경 버튼 클릭 시
		$("#changePasswordButton").click(function () {
			$("#zpassword").hide(); // 기존 비밀번호 필드 숨김
			$("#newCpw").val(""); // 새 비밀번호 필드 리셋
			$("#passwordConfirmationRow").show(); // 비밀번호 확인 필드 표시
			$("#passwordChangeRow").show(); // 비밀번호 확인 필드 표시
		});
		
		function validateFile() {
			var mmffInput = document.getElementById("lommff");
			var fileError = document.getElementById("fileError");
			var fileName = mmffInput.value;
			var allowedExtensions = ["jpg", "png"];

			if (fileName === "") {
				// 파일이 선택되지 않은 경우
				fileError.innerText = "파일을 선택하세요.";
				mmffInput.value = ""; // 파일 입력란 초기화
			} else {
				var fileExtension = fileName.split('.').pop().toLowerCase();

				if (allowedExtensions.indexOf(fileExtension) === -1) {
					// 파일 확장자가 허용되지 않는 경우
					mmffInput.value = ""; // 파일 입력란 초기화
					fileError.innerText = "지원되지 않는 파일 유형입니다. JPG 또는 PNG 파일을 업로드하세요.";
				} else {
					fileError.innerText = ""; // 오류 메시지 초기화
				}
			}
		}
	</script>
	
</body>

</html>